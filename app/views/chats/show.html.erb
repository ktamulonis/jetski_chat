<div class="chats-card chats-show sidebar-collapsed" data-sidebar-container>
  <% @chats = Chat.all if @chats.nil? %>

  <button
    type="button"
    class="sidebar-toggle"
    aria-label="Toggle sidebar"
    aria-expanded="false"
    data-sidebar-toggle
  >
    <span class="icon-open" aria-hidden="true">
      <svg
        width="20"
        height="20"
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M4 6H20M4 12H20M4 18H20"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
        />
      </svg>
    </span>
    <span class="icon-close" aria-hidden="true">
      <svg
        width="20"
        height="20"
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M6 6L18 18M6 18L18 6"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
        />
      </svg>
    </span>
  </button>

  <aside class="left-panel">
    <h2>Chats</h2>

    <div class="chat-list">
      <div class="new-chat">
        <form action="/chats" method="post">
          <button type="submit" class="new-chat-btn">+ New Chat</button>
        </form>
      </div>
      <% if Array(@chats).any? %>
        <div class="delete-all">
          <form action="/chats-delete-all" method="post">
            <button type="submit" class="delete-all-btn">Delete All</button>
          </form>
        </div>
      <% end %>

      <ul>
        <% if Array(@chats).empty? %>
          <li class="muted">No chats yet</li>
        <% end %>

        <% Array(@chats).each do |c| %>
          <li>
            <div class="chat-row">
              <a
                href="/chats/<%= c.id %>"
                class="<%= 'active' if c.id == @chat.id %>"
              >
                <%= (c.title && c.title.strip.size > 0) ? c.title : "Untitled" %>
              </a>
              <form action="/chat-delete" method="post">
                <input type="hidden" name="chat_id" value="<%= c.id %>" />
                <button
                  type="submit"
                  class="delete-chat-btn"
                  aria-label="Delete chat"
                >
                  <svg
                    width="14"
                    height="14"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                    aria-hidden="true"
                  >
                    <path
                      d="M6 7H18M9 7V5H15V7M10 11V17M14 11V17M7 7L8 19H16L17 7"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </button>
              </form>
            </div>
          </li>
        <% end %>
      </ul>
    </div>
  </aside>

  <main class="right-panel">
    <div class="chat-header">
      <h2><%= @chat.title %></h2>
      <button
        type="button"
        class="image-toggle"
        data-image-toggle
        aria-pressed="false"
      >
        Image: Off
      </button>
    </div>

    <!-- ========================================================= -->
    <!-- Messages -->
    <!-- ========================================================= -->
    <div class="messages-wrapper">
      <div class="messages" id="jetski-messages">
        <% Array(@messages).each do |message| %>
          <div
            class="message <%= message.role %>"
            data-jetski-model="Message"
            data-jetski-id="<%= message.id %>"
          >
            <strong><%= message.role %>:</strong>

            <div class="message-content" data-jetski-attr="content">
              <%= ERB::Util.html_escape(message.content.to_s) %>
            </div>
          </div>
        <% end %>
      </div>

      <button
        type="button"
        class="scroll-to-bottom"
        id="scroll-to-bottom"
        aria-label="Scroll to latest messages"
      >
        <svg
          width="18"
          height="18"
          viewBox="0 0 24 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
          aria-hidden="true"
        >
          <path
            d="M12 5V19M12 19L7 14M12 19L17 14"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
        </svg>
      </button>
    </div>

    <!-- ========================================================= -->
    <!-- Message form -->
    <!-- ========================================================= -->
    <form class="message-form" action="/messages" method="post">
      <input type="hidden" name="chat_id" value="<%= @chat.id %>" />
      <input
        type="hidden"
        name="image_mode"
        value="0"
        data-image-mode-input
      />

      <textarea
        name="content"
        placeholder="Type your message..."
        required
      ></textarea>

      <button type="submit" class="send-btn" aria-label="Send">
        <svg
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
          aria-hidden="true"
        >
          <path
            d="M2 21L23 12L2 3L2 10L17 12L2 14L2 21Z"
            fill="currentColor"
          />
        </svg>
      </button>
    </form>
  </main>
</div>
