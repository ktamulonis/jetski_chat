<div class="chats-card">
  <% @chats = Chat.all if @chats.nil? %>

  <aside class="left-panel">
    <h2>Chats</h2>

    <div class="chat-list">
      <div class="new-chat">
        <form action="/chats" method="post">
          <button type="submit" class="new-chat-btn">+ New Chat</button>
        </form>
      </div>

      <ul>
        <% if Array(@chats).empty? %>
          <li class="muted">No chats yet</li>
        <% end %>

        <% Array(@chats).each do |c| %>
          <li>
            <a
              href="/chats/<%= c.id %>"
              class="<%= 'active' if c.id == @chat.id %>"
            >
              <%= (c.title && c.title.strip.size > 0) ? c.title : "Untitled" %>
            </a>
          </li>
        <% end %>
      </ul>
    </div>
  </aside>

  <main class="right-panel">
    <h2><%= @chat.title %></h2>

    <!-- ========================================================= -->
    <!-- Messages -->
    <!-- ========================================================= -->
    <div class="messages-wrapper">
      <div class="messages" id="jetski-messages">
        <% Array(@messages).each do |message| %>
          <div
            class="message <%= message.role %>"
            data-jetski-model="Message"
            data-jetski-id="<%= message.id %>"
          >
            <strong><%= message.role %>:</strong>

            <p data-jetski-attr="content">
              <%= message.content.to_s %>
            </p>
          </div>
        <% end %>
      </div>

      <button
        type="button"
        class="scroll-to-bottom"
        id="scroll-to-bottom"
        aria-label="Scroll to latest messages"
      >
        <svg
          width="18"
          height="18"
          viewBox="0 0 24 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
          aria-hidden="true"
        >
          <path
            d="M12 5V19M12 19L7 14M12 19L17 14"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
        </svg>
      </button>
    </div>

    <!-- ========================================================= -->
    <!-- Message form -->
    <!-- ========================================================= -->
    <form class="message-form" action="/messages" method="post">
      <input type="hidden" name="chat_id" value="<%= @chat.id %>" />

      <textarea
        name="content"
        placeholder="Type your message..."
        required
      ></textarea>

      <button type="submit" class="send-btn" aria-label="Send">
        <svg
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
          aria-hidden="true"
        >
          <path
            d="M2 21L23 12L2 3L2 10L17 12L2 14L2 21Z"
            fill="currentColor"
          />
        </svg>
      </button>
    </form>
  </main>
</div>
